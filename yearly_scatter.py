import numpy as np
import matplotlib.pyplot as plt
import netCDF4 as nc
import string
import subprocess as sys
from scipy import stats

##########
#number of rainy days:
#VarExp=[2,1,2,1,3,1,0,2,0,1,0,7,0,2,2,2,1,0,0,3,0,0,0,2,0,0,1,2,0] # 1%
#VarExp=[3,4,3,1,5,2,1,4,0,2,3,9,0,5,2,2,2,2,1,3,2,1,1,5,0,1,1,3,2] # 2%
#VarExp=[5,11,4,1,6,3,3,5,1,5,4,13,1,8,4,2,4,2,1,3,3,1,2,5,0,1,2,3,2] #3%
#VarExp=[6,15,5,2,8,5,4,6,2,8,4,16,2,11,5,2,5,2,1,3,5,1,4,7,0,1,2,4,4]#4%
#VarExp=[6,15,6,2,11,8,6,7,3,8,4,17,3,11,6,5,7,2,1,4,7,3,5,8,4,3,2,6,5] #2010 3.12mm, 5%, rain on these day/total rain=0.600412
#VarExp=[8,16,8,2,13,8,6,9,3,10,6,17,5,13,7,5,9,3,2,7,9,4,6,8,6,4,2,7,7] #6%
#VarExp=[8,19,12,4,15,8,6,11,3,12,6,20,7,17,7,6,10,4,3,7,9,6,7,9,6,4,2,8,10] #7%
#VarExp=[8,20,12,5,17,9,7,11,4,15,6,22,8,18,7,8,12,4,4,8,9,8,10,9,8,5,3,9,13] #8%
#VarExp=[8,21,14,5,19,11,9,13,4,16,7,24,11,19,9,8,13,4,4,8,12,10,11,9,12,6,4,9,14]# 9%
#VarExp=[8,21,14,5,22,11,9,13,4,17,8,25,14,20,12,9,15,6,5,9,12,12,12,11,14,7,5,10,18] #2010 1.48mm 10% ratio=0.776743
#VarExp=[8,22,15,7,23,14,10,14,6,18,9,26,15,20,12,12,15,8,8,9,13,15,12,13,16,7,8,10,19] # 11%
#VarExp=[9,25,16,8,24,15,10,14,6,19,10,29,17,20,12,15,17,11,9,9,15,17,13,14,16,9,10,11,19] # 12%
#VarExp=[10,25,21,9,29,15,12,15,6,19,11,30,18,20,12,15,18,15,9,10,15,17,14,18,17,9,12,13,20] # 13%
#VarExp=[11,25,22,10,31,18,13,15,7,20,12,31,20,24,12,15,19,16,9,11,16,18,15,19,21,9,12,14,24] # 14%
#VarExp=[11,25,23,12,33,19,16,16,9,20,13,34,21,27,13,15,20,16,10,14,16,18,17,19,24,10,12,15,25]# 0.83mm 15% ratio=0.869225
#VarExp=[19,33,30,18,36,28,21,19,18,25,18,37,29,34,21,18,28,25,15,19,21,23,18,29,31,20,16,20,30] #20% ratio=0.924651
#VarExp=[21,39,34,25,45,38,25,27,29,28,25,44,35,44,27,22,29,34,23,25,24,26,23,36,37,25,24,23,35] #25%

#Var=[85,105,93,83,86,98,85,97,80,92,90,92,85,100,98,89,80,89,78,82,71,81,73,88,96,89,83,85,83]#2010 0mm

#Qaseem=[ 37.575 , 90.9   , 47.25 ,   6.125,  31.325 , 23.875,  10.225,\
#  12.55 ,   7.15  , 24.375 , 24.375 , 41.925 , 14.925,  32.175 , 16.875,  27.825,\
#  18.775,   2.675 ,  3.675 ,    29.775 ,  9.25 ,  20.05 ,  19.95 ,  13.425,\
#  16.075,   7.175 , 14.875, 11.325] #2010
#2001: nan
#Var=Qaseem
##########################
#IRR-CTR total rain:
#Var=[3.66595,9.54423,3.61781,1.33933,5.20378,4.59239,3.58113,3.97916,1.48132,2.36922,-1.54355,6.38017,2.74884,4.51502,2.58834,3.84946,0.74498,2.98459,1.00687,3.45049,2.99092,3.94642,3.08033,6.19827,4.11706,2.98192,1.4478,1.85563,2.68244]#2010
######################
#IRR-CTR on rainy days
#Var=[2.75035,7.06801,2.19487,1.24036,4.03056,3.17803,2.76751,3.32726,0.537906,0.618874,-2.22303,4.29367,1.95762,3.47948,1.38986,2.78577,-0.178864,1.74872,0.0681629,2.46751,2.19397,1.7434,2.53662,5.57642,2.6457,0.944841,0.510527,1.01077,1.60707]

###################
#yearly=[1981,1982,1983,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2002,2003,2004,2005,2006,2007,2008,2009,2010]
yearly=[1981, 1982, 1983, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
#Var=yearly
#############################
#averaged rain on rainy days (intensity): 
#VarExp=[9.2263,6.16661,8.68536,6.86782,6.98015,8.12529,5.38969,7.8028,4.36049,6.76367,7.47127,9.37172,4.17499,8.04943,7.28467,7.15177,6.3388,7.43926,8.10014,10.8976,5.41431,4.75212,5.42323,7.46588,3.54802,4.76881,8.66438,7.40207,5.51915] #2010 3.12mm
#VarExp=[7.61739,5.36719,5.6023,4.60125,5.81614,8.12529,5.38969,5.91512,4.36049,5.35706,5.9389,8.34285,3.34193,6.12371,6.68506,6.36757,5.21417,4.97229,4.49243,7.38131,4.82717,3.63155,4.60678,6.8976,3.28721,4.35058,8.66438,6.22572,4.04973]# 7%
#VarExp=[7.61739,5.19586,5.6023,4.06874,5.38606,7.43457,4.92482,5.91512,3.77131,4.69206,5.9389,7.76915,3.19911,5.89696,6.68506,5.31075,4.68767,4.97229,3.84275,6.71204,4.82717,3.21898,3.82497,6.8976,2.93307,3.87978,6.4562,5.74717,3.59308] # 8%
#VarExp=[7.61739,5.02926,5.04517,4.06874,4.53713,6.40373,4.23207,5.28263,3.77131,4.33121,4.88806,7.03773,2.53643,5.47892,4.56942,4.8923,4.06268,3.84637,3.38,6.14402,4.05617,2.70825,3.46995,5.92962,2.4022,3.2269,4.51205,5.33493,3.04296] #2010 10% 1.48mm
#VarExp=[5.82684,4.42371,3.49491,2.3475,3.38011,4.19104,2.81776,4.50018,2.25927,3.85449,3.42101,5.46342,2.05597,4.29622,4.28221,3.44118,3.30948,2.16378,2.30575,4.27434,3.3456,2.22705,2.74148,3.92479,1.83323,2.58672,2.612,3.89632,2.4701] # 0.83mm 15%
#VarExp=[3.64183,3.50498,2.8365,1.80184,3.15031,3.03167,2.29019,3.8954,1.46777,3.21278,2.64947,5.07477,1.66968,3.5444,2.89622,2.98083,2.55261,1.62432,1.765,3.33214,2.70668,1.89838,2.63073,2.79329,1.57248,1.61624,2.11765,3.07688,2.16787] #20%

##################################
#CTR total rain on rainy days:
#Var=[50.8701,75.8112,43.9719,9.7005,57.6731,46.0654,20.6325,46.0418,5.57085,41.2047,29.8851,142.304,4.97612,75.5584,36.511,25.1458,33.3545,14.8785,8.10014,40.313,21.1387,7.775,15.1052,47.3235,0,7.44275,17.3288,33.1474,15.5547] #3%
#Var=[60.9391,101.977,67.2276,18.405,87.2421,65.0024,32.3381,65.0663,13.0815,64.2847,35.6334,166.857,23.3935,104.103,46.7954,38.2054,52.1417,19.8892,13.4773,51.6692,43.4445,21.7893,32.2475,62.0784,19.7233,17.4023,17.3288,49.8058,40.4973] #7%
#Var=[60.9391,105.614,70.6323,20.3437,99.8169,71.9174,38.0886,68.6741,15.0852,73.6307,39.1044,175.943,35.5101,109.578,54.833,44.0307,60.9402,23.0782,16.9,55.2962,48.6741,32.499,41.6395,65.2258,33.6308,22.5883,22.5602,53.3493,54.7733] # 10%
#Var=[64.0953,110.593,80.3829,28.17,111.544,79.6298,45.0841,72.0029,20.3334,77.0897,44.4731,185.756,43.1754,115.998,55.6687,51.6177,66.1896,34.6205,23.0575,59.8407,53.5296,40.0868,46.6052,74.5711,43.9975,25.8672,31.344,58.4448,61.7526] #15%
#Var=[69.8654,118.226,86.5657,35.198,116.64,88.5356,49.7536,77.0626,30.949,81.6526,50.6278,190.666,50.7803,124.315,63.2837,55.1483,71.7894,44.2462,29.9722,65.5497,58.0236,44.805,49.4517,83.7698,51.3348,34.5085,37.199,62.5171,67.0127] #25%

#######################
#CTR total rain:
#VarExp=[ 18.2079  ,  30.48175 ,  22.319975,   9.39855 ,  29.58675 , 23.008325,  13.15545 ,  20.329025,   8.3887  ,  21.217475, 13.391225,  48.498   ,  13.351925,  31.74075 ,  16.975125, 14.6581  ,  18.4571  ,  11.8514  ,   8.286025,  15.05725 , 12.251875,  12.91485 ,  21.62095 ,  13.429125,   9.682325, 9.9988  ,  16.569425,  17.58565 ] #2010 unit in per month
#2001: 67.5063 this is to compared with obs
Var=[ 18.2079  ,  30.48175 ,  22.319975,   9.39855 ,  29.58675 , 23.008325,  13.15545 ,  20.329025,   8.3887  ,  21.217475, 13.391225,  48.498   ,  13.351925,  31.74075 ,  16.975125,14.6581  ,  18.4571  ,  11.8514  ,   8.286025,  16.876575,15.05725 ,  12.251875,  12.91485 ,  21.62095 ,  13.429125,9.682325,   9.9988  ,  16.569425,  17.58565 ] #2010  unit in per month
########################
#IRR total rain:
VarExp=[ 19.1244  ,  32.86775 ,  23.224425,   9.733375,  30.8875 , 24.156425,  14.050725,  21.323825,   8.759025,  21.809775, 13.005325,  50.09325 ,  14.039125,  32.8695  ,  17.622225, 15.620475,  18.643325,  12.59755 , 8.537725,  17.7392  , 15.805 ,  13.2385  ,  13.684925, 23.1705 , 14.4584 , 10.4278 , 10.36075 , 17.033325, 18.25625 ]
############################################
#CTR Feb:
#Var=[10.7087,14.7297,1.53255,0.0282278,24.8628,17.6777,9.30516,18.6692,7.13499,29.2573,1.94088,41.7598,1.4476,25.8576,6.55454,0.312208,1.19933,19.4794,11.7488,1.22017,8.62868,3.26022,0.590257,22.6867,9.41876,3.18708,3.54571,2.90522,2.44224]
#IRR Feb:
#VarExp=[11.2561,15.1199,1.59787,0.0401859,25.4038,18.16,9.28429,19.4659,7.61429,29.6742,2.04383,42.5984,1.41262,25.9889,6.74934,0.30635,1.16722,20.25,11.9139,1.31953,8.85478,3.121,0.625517,22.9013,9.33896,3.43734,3.8232,2.9516,2.49287]
#CTR Mar:
#Var=[57.7435,7.91695,15.7205,11.0026,14.9503,54.0245,1.46888,21.5781,16.5454,30.046,22.5317,51.1267,12.2635,48.4629,28.7431,37.3173,41.2613,16.996,5.25556,53.8923,34.5657,18.6635,7.32978,35.1992,8.66054,11.144,0.74559,3.38807,7.68447]
#IRR Mar:
#VarExp=[60.541,8.11638,15.878,11.3527,17.0902,55.7874,1.51201,21.1363,16.9276,30.3926,22.981,52.0984,12.8755,49.7983,29.5231,39.0676,41.8613,18.3008,5.44814,56.4557,35.9922,19.1825,8.18216,36.265,9.53505,11.3318,0.728864,3.31973,8.23345]
#CTR Apr:
#Var=[2.31236,58.9071,45.0151,20.9904,67.4307,7.912,41.0758,39.2858,6.31032,25.4143,25.8942,69.7109,24.5764,47.0263,28.6632,15.3052,20.6853,9.56173,12.0422,11.2754,16.9517,12.3887,43.4316,26.3828,16.918,19.4035,28.4356,34.1537,43.6241]
#IRR Apr:
#VarExp=[2.20321,65.4936,46.2736,22.1542,68.9529,9.04076,44.5082,42.379,6.74831,27.017,23.2231,71.8046,25.7723,48.8015,29.8885,16.515,21.4351,10.1561,12.1908,11.807,18.0402,13.9756,45.4497,31.1246,19.0623,21.2385,28.667,33.7531,45.6387]
#CTR May:
#Var=[2.06699,40.3733,27.0118,5.5729,11.1028,12.4191,0.771932,1.78301,3.56407,0.152267,3.19815,31.3951,15.1202,5.61656,3.93966,5.69772,10.6825,1.36843,4.09756,1.11837,0.0829,14.6951,0.307766,2.21512,18.7192,4.99469,7.26833,25.8307,16.5917]
#IRR May:
#VarExp=[2.49722,42.7413,29.1483,5.38646,12.1034,13.6375,0.898426,2.31399,3.74599,0.155193,3.77339,33.8712,16.0961,6.88965,4.32794,6.59293,10.1098,1.68324,4.59808,1.37457,0.332755,16.6749,0.482355,2.39113,19.8973,5.70356,8.22398,28.1089,16.6599]
############################################

print("##############")
print(np.var(Var))
print(np.var(VarExp))
F=(np.var(Var))/(np.var(VarExp))
p_value = stats.f.cdf(F, len(Var)-1, len(VarExp)-1)
print("p="+str(p_value))
print("##############")
#####################
xlabel=''
ylabel=''
#xlabel='Rainy days'
#ylabel='IRR-CTR (mm)'
#ylabel='CTR total rain on rainy days'
#xlabel='number of days with rain more than 0.56mm'
#xlabel='Averaged rain on rainy days (mm)'

print("-------------")
print("(Pearson's correlation coefficient,  2-tailed p-value)")
corr,pvalue=(stats.pearsonr(Var,VarExp))
print(stats.pearsonr(Var,VarExp))
print("-------------")
figtitle='r= '+str(corr)+', p-value= '+str(pvalue)

Var=np.array(Var)
VarExp=np.array(VarExp)
print(Var.shape)

fig=plt.figure()
ax1=fig.add_subplot(111)
ax1.plot(Var, VarExp, 'o')
#fig.suptitle("("+str(ygrid)+", "+str(xgrid)+") Precipitation")
ax1.grid()
ax1.set_xlabel(xlabel)
ax1.set_ylabel(ylabel)
fig.suptitle(figtitle)
ax1.set_ylim([0,100])
ax1.set_xlim([0,100])

for i, txt in enumerate(yearly):
    ax1.annotate(txt, (Var[i],VarExp[i]))

figname= (raw_input('figname? '))
#figname="rainy_day_precipAno"
if figname!="no":
	plt.savefig('/home/L.r02229011/wrf_fig/'+figname+'.png',bbox_inches=0)
	plt.savefig('/home/L.r02229011/wrf_fig/'+figname+'.pdf',bbox_inches=0)
plt.show()
